# Cloud/SCDF Deployment Configuration
# This profile supports both Spring Cloud Data Flow (SCDF) and cloud deployments
app.processor.mode=scdf

# OpenAI Configuration (from VCAP_SERVICES)
# Will use the first service that provides an API key
# You can bind any service that provides 'api-key' in its credentials
spring.ai.openai.api-key=${vcap.services.*.credentials.api-key}
spring.ai.openai.embedding.options.model=${vcap.services.*.credentials.embedding-model:text-embedding-3-small}

# PostgreSQL Configuration (auto-configured by Spring Boot's Cloud Foundry support)
# Will automatically bind to any PostgreSQL service in VCAP_SERVICES
spring.datasource.driver-class-name=org.postgresql.Driver

# Let Spring Boot auto-configure the DataSource from VCAP_SERVICES
# It will automatically detect and use the first bound database service
# and set the following properties:
# - spring.datasource.url
# - spring.datasource.username
# - spring.datasource.password

# Vector Store Configuration (pgvector)
spring.ai.vectorstore.pgvector.enabled=true
spring.ai.vectorstore.pgvector.initialize-schema=true
spring.ai.vectorstore.pgvector.dimensions=768  
spring.ai.vectorstore.pgvector.distance-type=COSINE_DISTANCE
#spring.ai.vectorstore.pgvector.table-name=embeddings

# Cloud Foundry specific settings
spring.application.name=${vcap.application.name:embedProc}
info.app.name=@project.artifactId@
info.app.version=@project.version@

# Enable Cloud Foundry connector
#spring.cloud.cloudfoundry.enabled=true

# Monitoring & Metrics Configuration
# Enable RabbitMQ metrics publishing for distributed monitoring
app.monitoring.rabbitmq.enabled=true
app.monitoring.rabbitmq.queue-name=embedproc.metrics

# Logging configuration
logging.level.root=INFO
logging.level.com.baskettecase=DEBUG
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n

# Application-specific logging
logging.level.com.baskettecase.embedProc=DEBUG
logging.level.org.springframework.ai=DEBUG
logging.level.org.springframework.cloud.stream=DEBUG

# Spring Cloud Stream Configuration
# These will be set by cloud deployment or SCDF
#app.processor.cloud.input-channel=textProcInput
#app.processor.cloud.output-channel=textProcOutput

# Actuator and probe endpoints
management.endpoints.web.exposure.include=health,info
management.endpoint.health.probes.enabled=true
management.server.port=8081
#debug=true

# Spring Cloud Stream bindings
spring.cloud.stream.bindings.embedProc-in-0.destination=textInput
spring.cloud.stream.bindings.embeddingLogOutput.destination=embedding.log
spring.cloud.function.definition=embedProc

# Default query text for vector operations
app.query.text="What products does UDM contain?"